# Assetto Corsa Script

Набор утилит и скриптов для **Assetto Corsa (AC, 2014)** под Windows:
- чтение и запись телеметрии через Shared Memory;
- оверлей-монитор руля/педалей/состояний;
- управление музыкой/громкостью на скорости;
- маппер кнопок руля (MOZA / геймпады) и хоткеи для пит-стратегии;
- вспомогательные инструменты (логирование, экспорт в CSV/JSON).

> ⚠️ Репозиторий ориентирован на **Assetto Corsa (не ACC)**. Для работы большинства скриптов требуется **Content Manager (CM)** и **Custom Shaders Patch (CSP)**, а также установленный Python 3.10+ (Windows).

---

## Содержание

- [Структура](#структура)
- [Требования](#требования)
- [Установка](#установка)
- [Скрипты и как их использовать](#скрипты-и-как-их-использовать)
  - [ac_telemetry.py](#ac_telemetrypy)
  - [moza_monitor.py](#moza_monitorpy)
  - [moza_buttons_mapper.py](#moza_buttons_mapperpy)
  - [moza_ac_music_combo.py](#moza_ac_music_combopy)
- [Конфигурация](#конфигурация)
- [Автозапуск с Content Manager](#автозапуск-с-content-manager)
- [FAQ](#faq)
- [Лицензия и права](#лицензия-и-права)
- [Вклад и обратная связь](#вклад-и-обратная-связь)

---

## Структура

Примерная структура репозитория (может отличаться от фактической):

```
Assetto-Corsa-Script/
├─ scripts/
│  ├─ ac_telemetry.py           # просмотр телеметрии, экспорт CSV/JSON
│  ├─ moza_monitor.py           # мини-оверлей руля/педалей + запись
│  ├─ moza_buttons_mapper.py    # маппер кнопок и хоткеев (MOZA/геймпад)
│  └─ moza_ac_music_combo.py    # связка AC ↔ музыка (регулировка громкости и т.п.)
├─ config/
│  ├─ settings.json             # общие настройки (пути, клавиши, пороги)
│  └─ bindings.json             # бинды для маппера
├─ data/
│  └─ logs/                     # логи и записанные CSV/JSON
├─ docs/
│  └─ screenshots/              # скриншоты интерфейсов
├─ requirements.txt
└─ README.md
```

Если имена файлов у вас другие — см. разделы ниже и замените названия.

---

## Требования

- **Windows 10/11**
- **Python 3.10+** (рекомендуется 3.11)
- Пакеты Python: `pygame`, `pywin32`, `keyboard`, `psutil`, `matplotlib` (по необходимости).
- **AutoHotkey v1/ v1.1** (для `.ahk`, если используете AHK-скрипты/биндинги).
- **Assetto Corsa + Content Manager + CSP**

> Для корректной работы захвата геймпада/руля вне фокуса используйте окружение  
> `SDL_JOYSTICK_ALLOW_BACKGROUND_EVENTS=1` — некоторые скрипты уже выставляют его сами.

---

## Установка

```powershell
# 1) Клонируем репозиторий
git clone https://github.com/Iosif2321/Assetto-Corsa-Script.git
cd Assetto-Corsa-Script

# 2) Создаём и активируем виртуальное окружение
py -3.11 -m venv .venv
.\.venv\Scriptsctivate

# 3) Ставим зависимости
pip install -r requirements.txt
```

> Если `requirements.txt` отсутствует, установите вручную нужные пакеты:
> `pip install pygame pywin32 keyboard psutil matplotlib`

---

## Скрипты и как их использовать

Ниже — описание наиболее типичных файлов. Если имена в вашем репозитории другие, просто сопоставьте по назначению.

### `ac_telemetry.py`

**Назначение:** чтение телеметрии AC (Shared Memory), просмотр ключевых параметров, запись в CSV/JSON. Часто содержит:
- графики/стрим значений (скорость, обороты, угол руля, педали, шины, передача);
- режим «ленивого подключения» (скрипт ждёт, пока игра запустится);
- опцию экспорта: `--csv data/logs/telemetry_YYYY-MM-DD.csv`.

**Запуск:**
```powershell
.\.venv\Scriptsctivate
python .\scriptsc_telemetry.py --csv .\data\logs	elemetry.csv --fps 30
```

**Параметры (пример):**
- `--csv <path>` — путь к выходному CSV.
- `--json <path>` — путь к JSON-логу (альтернатива или вместе).
- `--fps <n>` — частота обновления графиков/экрана.
- `--headless` — запись без отрисовки окна.

---

### `moza_monitor.py`

**Назначение:** компактный оверлей поверх всех окон с индикаторами:
- угол руля (-900° … +900°), нормализованный %,
- педали (газ/тормоз/сцепление) 0–100%,
- шифты/шаблоны значений (минимумы/максимумы), журнал.

Есть режим **записи** (в `data/logs/`), управление размером/соотношением мини-окна, хоткеи.

**Запуск:**
```powershell
.\.venv\Scriptsctivate
python .\scripts\moza_monitor.py --always-on-top --record --out .\data\logs\monitor.csv
```

**Полезно знать:**
- Если педали показывают 2…98%: откалибруйте в драйвере MOZA и/или задайте `deadzone_min/max` в `config/settings.json`.
- Для 900° у руля задайте `steer_lock: 900` в конфиге.

---

### `moza_buttons_mapper.py`

**Назначение:** маппинг кнопок руля/геймпада на горячие клавиши Windows/AC (например: F1 — камеры, удержание W — «взгляд назад», Alt+L — фарами мигать, стрелки — меню пит-стратегии).

Часто реализовано через низкоуровневый `SendInput`/scancodes, чтобы работало **поверх всех окон**.

**Запуск (от админа):**
```powershell
.\.venv\Scriptsctivate
python .\scripts\moza_buttons_mapper.py --profile .\configindings.json
```

**Советы:**
- Запускайте «от имени администратора», иначе перехват/инъекция клавиш могут не сработать.
- Поддерживаются «короткое/долгое» нажатия (`holdMs`, `tapDelayMs`), «мульти-нажатия», модификаторы.

---

### `moza_ac_music_combo.py`

**Назначение:** связка AC ↔ системный плеер (регулировка громкости по скорости, пауза на пит-лейне, хоткеи трек-контролла и т.п.).

**Запуск:**
```powershell
.\.venv\Scriptsctivate
python .\scripts\moza_ac_music_combo.py --config .\config\settings.json
```

**Параметры (пример):**
- `--player yandex|aimp|system` — выбор интеграции.
- `--speed-volume on|off` — включить «чем быстрее — тем тише».
- `--hotkeys on|off` — перехват хоткеев следующего/предыдущего трека и т.п.

---

## Конфигурация

Основные настройки лежат в `config/`:

- **`settings.json`** — общие параметры:
  ```json
  {
    "steer_lock": 900,
    "deadzone": { "throttle_min": 0.00, "brake_min": 0.00, "clutch_min": 0.00 },
    "overlay": { "always_on_top": true, "width": 420, "height": 180 },
    "logging": { "enabled": true, "dir": "data/logs", "format": "csv" },
    "music": { "player": "yandex", "speed_volume": true, "min_volume": 0.20, "max_volume": 1.00 }
  }
  ```

- **`bindings.json`** — бинды маппера:
  ```json
  {
    "holdMs": 250,
    "tapDelayMs": 120,
    "bindings": {
      "BTN_22": { "short": "KEY_F1", "long": "HOLD_W" },
      "BTN_8":  { "hold":  "HOLD_Q" },
      "BTN_6":  { "hold":  "HOLD_E" },
      "BTN_19": { "short": "ALT_L_TAP", "long": "ALT_L_BLINK" },
      "BTN_1+BTN_8": "ARROW_LEFT_REPEAT",
      "BTN_1+BTN_7": "ARROW_DOWN_REPEAT",
      "BTN_1+BTN_6": "ARROW_RIGHT_REPEAT",
      "BTN_1+BTN_5": "ARROW_UP_REPEAT"
    }
  }
  ```

> Номера кнопок могут отличаться для разных рулей/геймпадов — уточняйте в логах скрипта (обычно выводит «detected: BTN_…» при нажатии).

---

## Автозапуск с Content Manager

**Content Manager → Settings → Drive → Launchers → Run program before/after:**
- Добавьте вызовы ваших скриптов (через `.bat` или прямой `python`).
- Пример `.bat` (запуск окружения и двух скриптов):
  ```bat
  @echo off
  call "%~dp0..\..\.venv\Scripts\activate.bat"
  start "" python "%~dp0..\..\scripts\moza_monitor.py" --always-on-top --record
  start "" python "%~dp0..\..\scripts\moza_buttons_mapper.py" --profile "%~dp0..\..\config\bindings.json"
  ```
- Для прав администратора используйте Планировщик заданий Windows или ярлык с галкой «Запуск от имени администратора».

---

## FAQ

**Индикаторы педалей показывают 2–98% вместо 0–100%.**  
Проведите калибровку в драйвере MOZA и задайте «мертвые зоны» в `settings.json` → `deadzone_*`.

**Руль отображается как −444° / +435°, хотя настроено 900°.**  
Проверьте `steer_lock` в `settings.json` (должно быть `900`). Если используете нормализацию, убедитесь в корректном вычислении мин/макс при старте (скрипт может обучаться в первые секунды).

**Окно не всегда поверх остальных.**  
Запускайте с `--always-on-top` и/или используйте WinAPI (pywin32) принудительно. На многоэкранных системах проверьте DPI-масштаб.

**Хоткеи не срабатывают.**  
Запускайте консоль/ярлык «от имени администратора». Закройте другие утилиты, перехватывающие клавиатуру/геймпад (Overwolf, overlays и т.п.).

---

## Лицензия и права

Если в репозитории присутствует файл `LICENSE`, **приоритет за ним**.  
Иначе рекомендуется **MIT License** (разрешает использование, копирование, модификацию и распространение при сохранении копирайта и текста лицензии).

Кратко:
- ✅ Можно использовать в личных/коммерческих проектах.
- ✅ Можно модифицировать и распространять форки.
- ✅ Просьба сохранять указание авторства/ссылку на репозиторий.
- ❌ ПО поставляется «как есть», без гарантий работоспособности или поддержки.

Полный текст MIT можно добавить отдельным файлом `LICENSE`:
```
MIT License

Copyright (c) 2025 ...

Permission is hereby granted, free of charge, to any person obtaining a copy
...
```

---

## Вклад и обратная связь

PR/Issues приветствуются:
- баг-репорты с логами (`data/logs/*.log|*.csv`);
- предложения по калибровкам (углы руля, мёртвые зоны);
- новые биндинги под конкретные рули/геймпады/педали;
- улучшения UI мини-окна (масштаб/соотношение/шрифты).

Если скрипт полезен — поставь ⭐ репозиторию.
